{% extends 'main.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/home.css' %}">

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h2>System Dashboard / <span>{{ request.user.users.name|upper }}</span></h2>
            <div class="engine-id">NODE_ID: {{ request.user.id|add:"1000" }}</div>
        </div>
        
        <div class="profile-grid">
            <div class="data-node">
                <span class="node-label">Auth Identity</span>
                <span class="node-value">{{ request.user.username }}</span>
            </div>

            <div class="data-node">
                <span class="node-label">Network Email</span>
                <span class="node-value">{{ request.user.email }}</span>
            </div>

            <div class="data-node">
                <span class="node-label">Verified Contact</span>
                <span class="node-value">{{ request.user.users.phone }}</span>
            </div>

            <div class="data-node">
                <span class="node-label">Account Status</span>
                <div class="status-container">
                    <span class="status-indicator"></span>
                    <span class="status-text">{{ request.user.users.status|upper }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-wrapper">
        <div class="section-header">
            <h3>Your Managed Assets</h3>
            <div class="action-bar">
                {% if active_acc_count < 5 %}
                    <a href="{% url 'new_account' %}" class="btn-action">+ New Account</a>
                {% else %}
                    <span class="btn-action limit-reached">ðŸ”’ Account Slots Full (5/5)</span>
                {% endif %}
                <a href="{% url 'transfer' %}" class="btn-action">Transfer Funds</a>
            </div>
        </div>

        <div class="accounts-grid">
            {% for acc in accounts %}
            <div class="account-card {% if acc.status == 'INACTIVE' %}inactive
                                     {% elif acc.accounttype == 'SAVINGS' %}card-savings
                                     {% elif acc.accounttype == 'CURRENT' %}card-current
                                     {% elif acc.accounttype == 'INVESTMENT' %}card-investment
                                     {% endif %}">
                <span class="card-label">{{ acc.accounttype }}</span>
                
                {% if acc.status == 'INACTIVE' %}
                    <div class="closed-badge">Closed</div>
                {% endif %}

                <div class="card-no">**** **** {{ acc.accountnumber|slice:"-4:" }}</div>
                
                <div class="balance-info">
                    <div style="font-size: 0.7rem; opacity: 0.7; text-transform: uppercase;">Available Balance</div>
                    <div class="balance-amt">â‚¹{{ acc.balance }}</div>
                </div>

                <div class="card-footer">
                    {% if acc.status == 'ACTIVE' %}
                        <a href="{% url 'transfer' %}?from={{ acc.accountid }}" class="btn-card-action" title="Transfer from this account">
                            Transfer
                        </a>
                        <a href="{% url 'statements' %}" class="btn-card-action" title="Get PDF Statement">
                            Statement
                        </a>
                        <a href="{% url 'deactivate_account' acc.accountid %}" class="btn-deactivate">
                            Deactivate
                        </a>
                    {% else %}
                        <span class="permanently-closed">PERMANENTLY CLOSED</span>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-ledgers">
                <p>No active ledgers found for this identity.</p>
                <a href="{% url 'new_account' %}" class="btn-provision">Deploy First Account</a>
            </div>
            {% endfor %}
        </div>
        </div>
{% endblock %}