{% extends 'main.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/home.css' %}">

    <div class="dashboard-container">
        <h2 style="color: #1a365d; margin-bottom: 30px; font-weight: 800; letter-spacing: -1px;">
            System Dashboard / <span style="color: #3498db;">{{ request.user.users.name|upper }}</span>
        </h2>
        
        <div class="profile-card">
            <div class="data-group">
                <span class="label">Auth Identity</span>
                <span class="value">{{ request.user.username }}</span>
            </div>
            
            <div class="data-group">
                <span class="label">System Email</span>
                <span class="value">{{ request.user.email }}</span>
            </div>

            <div class="data-group">
                <span class="label">Linked Phone</span>
                <span class="value">{{ request.user.users.phone }}</span>
            </div>

            <div class="data-group">
                <span class="label">Engine Status</span>
                <div><span class="status-pill">{{ request.user.users.status }}</span></div>
            </div>
        </div>
    </div>

    <div class="dashboard-wrapper">
        <div class="section-header">
            <h3>Your Managed Assets</h3>
            <div class="action-bar">
                {% if active_acc_count < 5 %}
                    <a href="{% url 'new_account' %}" class="btn-action">+ New Account</a>
                {% else %}
                    <span class="btn-action" style="opacity: 0.5; cursor: not-allowed; border-color: #ef4444; color: #ef4444;" title="Maximum account limit reached">
                    ðŸ”’ Account Slots Full (5/5)
                    </span>
                {% endif %}
                <a href="{% url 'transfer' %}" class="btn-action">Transfer Funds</a>
            </div>
        </div>

        <div class="accounts-grid">
            {% for acc in accounts %}
            <div class="account-card {% if acc.status == 'INACTIVE' %}inactive
                                     {% elif acc.accounttype == 'SAVINGS' %}card-savings
                                     {% elif acc.accounttype == 'CURRENT' %}card-current
                                     {% elif acc.accounttype == 'INVESTMENT' %}card-investment
                                     {% endif %}">
                <span class="card-label">{{ acc.accounttype }}</span>
                
                {% if acc.status == 'INACTIVE' %}
                    <div class="closed-badge">Closed</div>
                {% endif %}

                <div class="card-no">**** **** {{ acc.accountnumber|slice:"-4:" }}</div>
                
                <div class="balance-info">
                    <div style="font-size: 0.7rem; opacity: 0.7; text-transform: uppercase;">Available Balance</div>
                    <div class="balance-amt">â‚¹{{ acc.balance }}</div>
                </div>

                <div class="card-footer">
                    {% if acc.status == 'ACTIVE' %}
                        <a href="{% url 'deactivate_account' acc.accountid %}" class="btn-deactivate">
                            Deactivate Ledger
                        </a>
                    {% else %}
                        <span style="font-size: 0.65rem; color: #cbd5e1; font-weight: 800;">PERMANENTLY CLOSED</span>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div style="padding: 40px; background: white; border-radius: 15px; text-align: center; grid-column: 1/-1; border: 2px dashed #cbd5e1;">
                <p style="color: #64748b;">No active ledgers found for this identity.</p>
                <a href="{% url 'new_account' %}" class="btn-provision" style="text-decoration: none; display: inline-block; margin-top: 10px; background: var(--primary-navy); color: white; padding: 10px 20px; border-radius: 5px;">Deploy First Account</a>
            </div>
            {% endfor %}
        </div>

        <div class="section-header">
            <h3>System Audit Log (Recent Activity)</h3>
        </div>
        <div style="background: white; padding: 20px; border-radius: 15px; color: #94a3b8; text-align: center;">
            Transaction ledger is currently empty.
        </div>
    </div>
{% endblock %}